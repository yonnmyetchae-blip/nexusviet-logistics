<!DOCTYPE html>
<html>
<head>
  <title>Nexus Viet Air Cargo â€“ Admin</title>
</head>
<body>

<h2>Create Shipment</h2>

<h3>Sender</h3>
<input id="sender_name" placeholder="Sender Name"><br>
<input id="sender_phone" placeholder="Sender Phone"><br>

<h3>Receiver</h3>
<input id="receiver_name" placeholder="Receiver Name"><br>
<input id="receiver_phone" placeholder="Receiver Phone"><br>
<textarea id="receiver_address" placeholder="Receiver Address"></textarea><br>

<h3>Shipment</h3>
<select id="route">
  <option>YGN - HCM</option>
  <option>YGN - Hanoi</option>
  <option>YGN - DaNang</option>
  <option>HCM - YGN</option>
  <option>Hanoi - YGN</option>
  <option>Da Nang - YGN</option>
</select><br>

<input type="date" id="flight_date"><br>
<input id="item_desc" placeholder="Item Description"><br>

<h3>Fees</h3>
<input type="number" id="item_qty" placeholder="Item Quantity" value="1"><br>
<input type="number" id="handling_fee_mmk" placeholder="Handling Fee MMK (per item)"><br>
<input type="number" id="handling_fee_vnd" placeholder="Handling Fee VND (per item)"><br>
<input type="number" id="weight_kg" placeholder="Weight (KG)"><br>
<input type="number" id="rate_mmk" placeholder="Rate per KG MMK"><br>
<input type="number" id="rate_vnd" placeholder="Rate per KG VND"><br>

<h3>Status</h3>
<select id="status">
  <option>Received</option>
  <option>In Transit</option>
  <option>Arrived</option>
  <option>Delivered</option>
</select><br><br>

<button onclick="submitShipment()">Generate Invoice</button>

<script>
const API_URL = "https://script.google.com/macros/library/d/1raoqmSjafnU6Q27ui_0ZGhYpsfuT9mvpbljWi6-aHc4RqAsoAX806v4H/1";

function submitShipment() {
  const tracking = "NXS-" + Date.now();
  const invoice = "INV-" + Date.now();

  const qty = Number(item_qty.value || 1);
  const hMMK = Number(handling_fee_mmk.value || 0);
  const hVND = Number(handling_fee_vnd.value || 0);
  const w = Number(weight_kg.value || 0);
  const rMMK = Number(rate_mmk.value || 0);
  const rVND = Number(rate_vnd.value || 0);

  const payload = {
    tracking_no: tracking,
    invoice_no: invoice,
    sender_name: sender_name.value,
    sender_phone: sender_phone.value,
    receiver_name: receiver_name.value,
    receiver_phone: receiver_phone.value,
    receiver_address: receiver_address.value,
    route: route.value,
    flight_date: flight_date.value,
    item_desc: item_desc.value,
    item_qty: qty,
    handling_fee_mmk: hMMK,
    handling_fee_vnd: hVND,
    weight_kg: w,
    rate_mmk: rMMK,
    rate_vnd: rVND,
    total_mmk: (hMMK * qty) + (w * rMMK),
    total_vnd: (hVND * qty) + (w * rVND),
    status: status.value,
    remarks: ""
  };

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  }).then(() => {
    window.open(
      `invoice.html?tracking=${tracking}&invoice=${invoice}`,
      "_blank"
    );
  });
}
</script>

</body>
</html>
